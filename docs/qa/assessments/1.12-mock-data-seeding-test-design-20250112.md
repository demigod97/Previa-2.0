# Test Design: Story 1.12

Date: 2025-01-12
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 8 (44%)
- Integration tests: 6 (33%)
- E2E tests: 4 (22%)
- Priority distribution: P0: 8, P1: 6, P2: 4

## Test Scenarios by Acceptance Criteria

### AC1: Mock Data Button in TopBar

#### Scenarios

| ID                    | Level       | Priority | Test                                    | Justification                    |
| --------------------- | ----------- | -------- | --------------------------------------- | -------------------------------- |
| 1.12-UNIT-001         | Unit        | P0       | Button renders with correct styling     | Pure component rendering logic   |
| 1.12-UNIT-002         | Unit        | P0       | Button visibility for authenticated users | Auth state logic validation     |
| 1.12-UNIT-003         | Unit        | P1       | Loading state displays correctly        | UI state management             |
| 1.12-INT-001          | Integration | P0       | Button click triggers API call          | Component-service interaction   |
| 1.12-INT-002          | Integration | P1       | Toast notifications display properly    | UI feedback system integration  |
| 1.12-E2E-001          | E2E         | P0       | Complete user flow: click → success     | Critical user journey          |

### AC2: Australian Bank Account Generation

#### Scenarios

| ID                    | Level       | Priority | Test                                    | Justification                    |
| --------------------- | ----------- | -------- | --------------------------------------- | -------------------------------- |
| 1.12-UNIT-004         | Unit        | P0       | Bank account data generation logic    | Pure data generation algorithms   |
| 1.12-UNIT-005         | Unit        | P0       | Australian institution name validation  | Business logic validation       |
| 1.12-INT-003          | Integration | P0       | Bank accounts created in database        | Database operation validation  |
| 1.12-INT-004          | Integration | P1       | Account number masking format           | Data formatting validation      |
| 1.12-E2E-002          | E2E         | P1       | User sees generated bank accounts        | End-user experience validation  |

### AC3: Transaction Data Generation

#### Scenarios

| ID                    | Level       | Priority | Test                                    | Justification                    |
| --------------------- | ----------- | -------- | --------------------------------------- | -------------------------------- |
| 1.12-UNIT-006         | Unit        | P0       | Transaction amount range validation     | Business rule validation        |
| 1.12-UNIT-007         | Unit        | P1       | Australian merchant name generation     | Data generation logic           |
| 1.12-INT-005          | Integration | P0       | 30 transactions created in database     | Database bulk operation         |
| 1.12-INT-006          | Integration | P1       | Transaction date distribution           | Data integrity validation       |
| 1.12-E2E-003          | E2E         | P1       | User sees realistic transaction history | User experience validation      |

### AC4: Gamification Data Seeding

#### Scenarios

| ID                    | Level       | Priority | Test                                    | Justification                    |
| --------------------- | ----------- | -------- | --------------------------------------- | -------------------------------- |
| 1.12-UNIT-008         | Unit        | P2       | Badge award logic calculation           | Business logic validation       |
| 1.12-INT-007          | Integration | P1       | Gamification data created in database   | Database operation validation  |
| 1.12-E2E-004          | E2E         | P2       | User sees updated gamification profile  | User experience validation      |

### AC5: Edge Function Implementation

#### Scenarios

| ID                    | Level       | Priority | Test                                    | Justification                    |
| --------------------- | ----------- | -------- | --------------------------------------- | -------------------------------- |
| 1.12-INT-008          | Integration | P0       | Edge Function authentication validation | Security-critical path          |
| 1.12-INT-009          | Integration | P0       | Rate limiting enforcement               | Security and abuse prevention   |
| 1.12-INT-010          | Integration | P1       | Service role database operations        | Authorization validation        |

## Risk Coverage

### Security Risks
- **SEC-001**: Unauthorized data generation → Mitigated by 1.12-INT-008 (auth validation)
- **SEC-002**: Rate limiting bypass → Mitigated by 1.12-INT-009 (rate limiting test)

### Data Integrity Risks
- **DATA-001**: Invalid bank account data → Mitigated by 1.12-UNIT-004, 1.12-UNIT-005
- **DATA-002**: Transaction data corruption → Mitigated by 1.12-INT-005, 1.12-INT-006

### User Experience Risks
- **UX-001**: Button not visible to users → Mitigated by 1.12-UNIT-002, 1.12-E2E-001
- **UX-002**: Poor feedback during generation → Mitigated by 1.12-UNIT-003, 1.12-INT-002

## Recommended Execution Order

1. **P0 Unit tests** (fail fast on critical logic)
   - 1.12-UNIT-001: Button rendering
   - 1.12-UNIT-002: Auth visibility
   - 1.12-UNIT-004: Bank account generation
   - 1.12-UNIT-005: Institution validation
   - 1.12-UNIT-006: Transaction amounts

2. **P0 Integration tests** (critical system interactions)
   - 1.12-INT-001: Button-API interaction
   - 1.12-INT-003: Database bank account creation
   - 1.12-INT-005: Database transaction creation
   - 1.12-INT-008: Authentication validation
   - 1.12-INT-009: Rate limiting

3. **P0 E2E tests** (critical user journeys)
   - 1.12-E2E-001: Complete user flow

4. **P1 tests** (important functionality)
   - 1.12-UNIT-003: Loading states
   - 1.12-INT-002: Toast notifications
   - 1.12-INT-004: Account masking
   - 1.12-INT-006: Date distribution
   - 1.12-INT-007: Gamification data
   - 1.12-E2E-002: Bank account visibility
   - 1.12-E2E-003: Transaction history

5. **P2 tests** (nice-to-have)
   - 1.12-UNIT-007: Merchant generation
   - 1.12-UNIT-008: Badge logic
   - 1.12-E2E-004: Gamification profile

## Test Data Requirements

### Australian Context Validation
- **Bank Institutions**: Commonwealth Bank, ANZ, Westpac, NAB
- **Merchants**: Woolworths, Coles, BP, Shell, AGL, Telstra, Optus
- **Amount Ranges**: Salary ($3,000-$8,000), Groceries ($50-$300), Fuel ($40-$120)
- **Date Patterns**: Salary on 1st/15th, weekly groceries, bi-weekly fuel

### Test User Setup
- Authenticated user with valid session
- Clean database state (no existing mock data)
- Valid Supabase service role configuration

## Coverage Gaps Analysis

### No Gaps Identified
All acceptance criteria have appropriate test coverage:
- AC1: 6 test scenarios (button, loading, notifications, flow)
- AC2: 5 test scenarios (generation, validation, database, formatting)
- AC3: 5 test scenarios (amounts, merchants, database, dates)
- AC4: 3 test scenarios (badges, database, profile)
- AC5: 3 test scenarios (auth, rate limiting, service role)

## Test Environment Requirements

### Unit Tests
- Jest/Vitest framework
- React Testing Library for component tests
- Mock Supabase client
- No external dependencies

### Integration Tests
- Test database (Supabase local or test instance)
- Mock authentication service
- Real Edge Function deployment
- Service role configuration

### E2E Tests
- Full application environment
- Real Supabase cloud instance
- Authenticated user session
- Complete data generation flow

## Quality Metrics

### Coverage Targets
- **P0 Tests**: 100% pass rate required
- **P1 Tests**: 95% pass rate required
- **P2 Tests**: 90% pass rate acceptable

### Performance Targets
- **Unit Tests**: < 1 second per test
- **Integration Tests**: < 5 seconds per test
- **E2E Tests**: < 30 seconds per test

### Reliability Targets
- **Flaky Test Rate**: < 5%
- **Test Maintenance**: Minimal changes required
- **Debugging**: Clear failure messages and logs
