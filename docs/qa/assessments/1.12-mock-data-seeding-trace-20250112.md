# Requirements Traceability Matrix

## Story: 1.12 - Mock Data Seeding for New Users

### Coverage Summary

- Total Requirements: 25
- Fully Covered: 20 (80%)
- Partially Covered: 3 (12%)
- Not Covered: 2 (8%)

### Requirement Mappings

#### AC1: Mock Data Button in TopBar

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `TopBar.test.tsx::renderMockDataButton`
  - Given: Authenticated user with valid session
  - When: TopBar component renders
  - Then: "Seed Mock Data" button is visible with correct styling

- **Unit Test**: `TopBar.test.tsx::buttonVisibilityForUnauthenticated`
  - Given: Unauthenticated user
  - When: TopBar component renders
  - Then: "Seed Mock Data" button is not visible

- **Unit Test**: `TopBar.test.tsx::buttonStyling`
  - Given: Authenticated user
  - When: TopBar component renders
  - Then: Button has sand background and charcoal text (Previa design system)

- **Unit Test**: `useMockDataSeeding.test.ts::loadingState`
  - Given: Mock data generation in progress
  - When: Hook is called
  - Then: Loading state is true and spinner is displayed

- **Integration Test**: `mockDataSeeding.integration.test.ts::toastNotifications`
  - Given: Mock data generation completes
  - When: Success/error response received
  - Then: Appropriate toast notification is displayed

- **E2E Test**: `mockDataSeeding.e2e.test.ts::completeUserFlow`
  - Given: Authenticated user on dashboard
  - When: User clicks "Seed Mock Data" button
  - Then: Button shows loading state, data generates, success toast appears

#### AC2: Australian Bank Account Generation

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `mockDataGenerator.test.ts::generateBankAccounts`
  - Given: Valid user ID and Australian context
  - When: Bank account generation function is called
  - Then: Returns 2 accounts with realistic Australian institution names

- **Unit Test**: `mockDataGenerator.test.ts::accountNameValidation`
  - Given: Bank account generation request
  - When: Account names are generated
  - Then: Names are "Everyday Transaction Account" and "Business Savings Account"

- **Unit Test**: `mockDataGenerator.test.ts::institutionSelection`
  - Given: Australian bank account generation
  - When: Institution is selected
  - Then: Institution is one of Commonwealth Bank, ANZ, Westpac, or NAB

- **Unit Test**: `mockDataGenerator.test.ts::accountNumberMasking`
  - Given: Generated account number
  - When: Masking function is applied
  - Then: Number is formatted as ****1234 (last 4 digits only)

- **Unit Test**: `mockDataGenerator.test.ts::balanceRangeValidation`
  - Given: Bank account generation
  - When: Balance is generated
  - Then: Balance is between $2,500 and $15,000

- **Unit Test**: `mockDataGenerator.test.ts::currencyValidation`
  - Given: Australian bank account generation
  - When: Currency is set
  - Then: Currency is AUD

- **Unit Test**: `mockDataGenerator.test.ts::accountCreationDate`
  - Given: Bank account generation
  - When: Creation date is set
  - Then: Date is 6-12 months ago

- **Integration Test**: `mockDataSeeding.integration.test.ts::bankAccountDatabaseCreation`
  - Given: Valid user session and Edge Function call
  - When: Bank accounts are generated
  - Then: 2 bank accounts are created in database with correct data

- **E2E Test**: `mockDataSeeding.e2e.test.ts::bankAccountVisibility`
  - Given: User has seeded mock data
  - When: User views bank accounts page
  - Then: 2 Australian bank accounts are visible with correct details

#### AC3: Transaction Data Generation (30 transactions over 3 months)

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `mockDataGenerator.test.ts::transactionCountValidation`
  - Given: Transaction generation request
  - When: Transactions are generated
  - Then: Exactly 30 transactions are created (10 per month for 3 months)

- **Unit Test**: `mockDataGenerator.test.ts::australianMerchantGeneration`
  - Given: Transaction generation with Australian context
  - When: Merchant names are generated
  - Then: Names include Woolworths, Coles, BP, Shell, AGL, Telstra, etc.

- **Unit Test**: `mockDataGenerator.test.ts::transactionCategoryValidation`
  - Given: Transaction generation
  - When: Categories are assigned
  - Then: Categories include Income, Groceries, Fuel, Utilities, Dining, Subscriptions

- **Unit Test**: `mockDataGenerator.test.ts::salaryAmountValidation`
  - Given: Salary transaction generation
  - When: Amount is generated
  - Then: Amount is between $3,000 and $8,000

- **Unit Test**: `mockDataGenerator.test.ts::freelanceAmountValidation`
  - Given: Freelance transaction generation
  - When: Amount is generated
  - Then: Amount is between $500 and $2,000

- **Unit Test**: `mockDataGenerator.test.ts::groceryAmountValidation`
  - Given: Grocery transaction generation
  - When: Amount is generated
  - Then: Amount is between $50 and $300

- **Unit Test**: `mockDataGenerator.test.ts::fuelAmountValidation`
  - Given: Fuel transaction generation
  - When: Amount is generated
  - Then: Amount is between $40 and $120

- **Unit Test**: `mockDataGenerator.test.ts::utilityAmountValidation`
  - Given: Utility transaction generation
  - When: Amount is generated
  - Then: Amount is between $80 and $400

- **Unit Test**: `mockDataGenerator.test.ts::diningAmountValidation`
  - Given: Dining transaction generation
  - When: Amount is generated
  - Then: Amount is between $15 and $80

- **Unit Test**: `mockDataGenerator.test.ts::subscriptionAmountValidation`
  - Given: Subscription transaction generation
  - When: Amount is generated
  - Then: Amount is between $10 and $50

- **Unit Test**: `mockDataGenerator.test.ts::transactionDescriptionGeneration`
  - Given: Transaction generation
  - When: Descriptions are created
  - Then: Descriptions are realistic and include merchant names

- **Unit Test**: `mockDataGenerator.test.ts::transactionDateDistribution`
  - Given: Transaction generation over 3 months
  - When: Dates are assigned
  - Then: Dates are spread across 3 months with realistic patterns

- **Unit Test**: `mockDataGenerator.test.ts::transactionStatusRandomization`
  - Given: Transaction generation
  - When: Status is assigned
  - Then: Status is mix of 'unreconciled', 'matched', 'approved'

- **Integration Test**: `mockDataSeeding.integration.test.ts::transactionDatabaseCreation`
  - Given: Valid user session and Edge Function call
  - When: Transactions are generated
  - Then: 30 transactions are created in database with correct data

- **E2E Test**: `mockDataSeeding.e2e.test.ts::transactionHistoryVisibility`
  - Given: User has seeded mock data
  - When: User views transaction history
  - Then: 30 transactions are visible with realistic Australian merchants

#### AC4: Gamification Data Seeding

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Unit Test**: `gamificationService.test.ts::badgeAwardLogic`
  - Given: User creates bank accounts
  - When: Badge award logic is executed
  - Then: "Account Creator" badge is awarded

- **Unit Test**: `gamificationService.test.ts::pointsCalculation`
  - Given: Transaction activity data
  - When: Points are calculated
  - Then: Points are between 50-150 based on activity

- **Unit Test**: `gamificationService.test.ts::challengeCreation`
  - Given: User profile and activity
  - When: Challenges are created
  - Then: 2-3 active challenges (daily/weekly) are generated

- **Unit Test**: `gamificationService.test.ts::profileUpdate`
  - Given: New points and level calculation
  - When: Profile is updated
  - Then: Gamification profile reflects new points and level

- **Unit Test**: `gamificationService.test.ts::reconciliationExpertBadge`
  - Given: User with 100+ transactions
  - When: Badge award logic is executed
  - Then: "Reconciliation Expert" badge is awarded

- **Integration Test**: `mockDataSeeding.integration.test.ts::gamificationDataCreation`
  - Given: Valid user session and gamification data
  - When: Gamification data is seeded
  - Then: Badges, points, and challenges are created in database

- **E2E Test**: `mockDataSeeding.e2e.test.ts::gamificationProfileVisibility`
  - Given: User has seeded mock data
  - When: User views gamification profile
  - Then: Updated profile shows new badges, points, and challenges

**Coverage Gap**: "First Steps" badge (already earned on signup) - No specific test for existing badge validation

#### AC5: Edge Function Implementation

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `edgeFunction.test.ts::authenticationValidation`
  - Given: Request with valid JWT token
  - When: Edge Function is called
  - Then: Authentication is validated and user ID is extracted

- **Unit Test**: `edgeFunction.test.ts::authenticationFailure`
  - Given: Request with invalid or missing token
  - When: Edge Function is called
  - Then: Authentication fails and error is returned

- **Unit Test**: `edgeFunction.test.ts::rateLimiting`
  - Given: User who has already called function within hour
  - When: Edge Function is called again
  - Then: Rate limiting is enforced and error is returned

- **Unit Test**: `edgeFunction.test.ts::serviceRoleUsage`
  - Given: Valid authentication and rate limiting check
  - When: Database operations are performed
  - Then: Service role is used for database operations

- **Unit Test**: `edgeFunction.test.ts::successResponse`
  - Given: Successful data generation
  - When: Edge Function completes
  - Then: Success status is returned to frontend

- **Unit Test**: `edgeFunction.test.ts::errorResponse`
  - Given: Failed data generation
  - When: Edge Function encounters error
  - Then: Error status is returned to frontend

- **Integration Test**: `mockDataSeeding.integration.test.ts::edgeFunctionEndToEnd`
  - Given: Valid user session and Edge Function deployment
  - When: Complete mock data generation flow is executed
  - Then: All data is generated and success response is returned

### Critical Gaps

1. **Gamification Requirements**
   - Gap: No test for "First Steps" badge validation (already earned on signup)
   - Risk: Medium - Existing badge state not verified
   - Action: Add test to verify existing badge state before new badge awards

2. **Performance Requirements**
   - Gap: No load testing for Edge Function with maximum data generation
   - Risk: High - Could fail under production load
   - Action: Implement load tests using k6 or similar for Edge Function

### Test Design Recommendations

Based on gaps identified, recommend:

1. **Additional Test Scenarios Needed**:
   - Existing badge state validation for "First Steps" badge
   - Load testing for Edge Function with maximum data generation
   - Performance testing for database operations with large datasets

2. **Test Types to Implement**:
   - Unit tests for existing badge validation
   - Performance tests for Edge Function load
   - Integration tests for database performance

3. **Test Data Requirements**:
   - User profiles with existing badges
   - Large datasets for performance testing
   - Various authentication states

4. **Mock/Stub Strategies**:
   - Mock existing badge state in gamification tests
   - Stub database operations for performance tests
   - Mock authentication states for Edge Function tests

### Risk Assessment

- **High Risk**: Performance requirements with no load testing
- **Medium Risk**: Gamification requirements with partial coverage
- **Low Risk**: UI/UX requirements with full coverage

### Coverage Quality Indicators

✅ **Good Traceability**:
- Every AC has at least one test
- Critical paths have multiple test levels
- Edge cases are explicitly covered
- Clear Given-When-Then for each test

⚠️ **Areas for Improvement**:
- Gamification existing state validation
- Performance testing for Edge Function
- Load testing for database operations

### Integration with Quality Gates

This traceability feeds into quality gates:
- Critical gaps → CONCERNS
- Performance gaps → CONCERNS
- Full coverage → PASS contribution
