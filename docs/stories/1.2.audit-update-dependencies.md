# Story 1.2: Audit and Update Dependencies

## Status
Draft

## Story
**As a** developer,
**I want** to audit and update project dependencies for Previa financial domain requirements,
**so that** the codebase has appropriate packages for financial data handling and no legacy PolicyAi dependencies remain.

## Acceptance Criteria
1. Package.json name updated from "policyai" to "previa"
2. All dependencies are compatible with Previa financial use cases
3. Financial-specific libraries added where needed (currency formatting, charts, file processing)
4. Security vulnerabilities resolved in existing dependencies
5. No unused dependencies from PolicyAi domain remain
6. All package versions are up-to-date and compatible

## Tasks / Subtasks
- [ ] Update package metadata (AC: 1)
  - [ ] Change package name from "policyai" to "previa" in package.json
  - [ ] Update package description to reflect financial intelligence platform
  - [ ] Update version to 0.1.0 for Previa MVP
- [ ] Audit current dependencies for Previa compatibility (AC: 2, 5)
  - [ ] Review all @radix-ui components for financial UI needs
  - [ ] Validate React Query for financial data caching patterns
  - [ ] Check Recharts for financial charts and analytics
  - [ ] Verify date-fns for transaction date handling
  - [ ] Assess Zod for financial data validation schemas
- [ ] Add financial-specific dependencies (AC: 3)
  - [ ] Add currency.js or dinero.js for precise currency calculations
  - [ ] Add file processing libraries for bank statement parsing (xlsx, csv-parser)
  - [ ] Add react-dropzone for document upload functionality
  - [ ] Add moment-timezone or date-fns-tz for timezone handling in financial data
  - [ ] Consider adding react-pdf for PDF statement processing
- [ ] Security and version updates (AC: 4, 6)
  - [ ] Run npm audit to identify security vulnerabilities
  - [ ] Update all dependencies to latest compatible versions
  - [ ] Resolve any security warnings
  - [ ] Update Node.js and npm versions if needed
- [ ] Clean up unused dependencies (AC: 5)
  - [ ] Remove dependencies specific to PolicyAi features if any
  - [ ] Run dependency analyzer to identify unused packages
  - [ ] Remove dev dependencies not needed for Previa development
- [ ] Verify compatibility and testing (AC: 2, 6)
  - [ ] Ensure all dependencies work together without conflicts
  - [ ] Test application startup after dependency changes
  - [ ] Run existing tests to ensure no breaking changes
  - [ ] Update lock file and verify clean installation

## Dev Notes

### Previous Story Insights
Story 1.1 cleaned PolicyAi UI components. This story ensures the underlying package structure supports Previa financial requirements.

### Architecture Context
- **Tech Stack:** React 18 + TypeScript + Vite + shadcn/ui maintained [Source: architecture/1-goals-scope-constraints.md]
- **UI Framework:** shadcn/ui components continue to be primary choice [Source: TECHNICAL-DECISIONS.md#9]
- **Financial Domain:** Need libraries for currency handling, file processing, and financial data validation [Source: frontend-spec-new.md]

### Current Dependency Analysis
**Core Framework (Keep):** [Source: package.json analysis]
- React 18.3.1, React DOM, React Router - Core framework
- TypeScript 5.5.3 - Type safety
- Vite 5.4.1 - Build tool
- @supabase/supabase-js 2.49.8 - Backend integration

**UI Components (Keep - Perfect for Financial UI):** [Source: package.json + frontend-spec-new.md]
- All @radix-ui components - Accessible primitives for financial forms
- shadcn/ui ecosystem (class-variance-authority, clsx, tailwind-merge)
- Lucide React - Icons including financial symbols
- Sonner - Toast notifications for transaction feedback

**Financial-Ready Libraries (Keep):** [Source: package.json analysis]
- Recharts 2.12.7 - Financial charts and analytics
- React Hook Form + Hookform/resolvers - Form validation for financial data
- Zod 3.23.8 - Schema validation for financial data structures
- Date-fns 3.6.0 - Date handling for transactions
- React Query 5.56.2 - Data fetching and caching

**Missing Financial Libraries:** [Source: frontend-spec-new.md + financial domain requirements]
- Currency calculation library (currency.js/dinero.js)
- File processing (xlsx, csv-parser for bank statements)
- PDF processing (react-pdf for statement parsing)
- Drag/drop (react-dropzone for document uploads)
- Timezone handling (date-fns-tz for international transactions)

### Financial Domain Requirements
**Currency Handling:** [Source: frontend-spec-new.md#1.2]
- Need precise decimal arithmetic for financial calculations
- Support for AUD formatting with proper symbols
- Avoid floating-point errors in money calculations

**File Processing:** [Source: frontend-spec-new.md#2.3, #2.7]
- PDF parsing for bank statements
- CSV parsing for transaction imports
- Excel file support for accounting exports
- Drag/drop upload interface

**Charts and Analytics:** [Source: frontend-spec-new.md#2.3]
- Financial charts (line, bar, pie for spending analysis)
- Recharts already included - verify it meets requirements
- Time-series data visualization for transaction trends

### Package.json Updates Required
**Metadata Updates:**
```json
{
  "name": "previa",
  "description": "AI-powered financial intelligence platform",
  "version": "0.1.0"
}
```

**New Dependencies to Add:**
- `currency.js` or `dinero.js` - Precise currency calculations
- `react-dropzone` - File upload functionality
- `xlsx` - Excel file processing
- `csv-parser` or `papaparse` - CSV processing
- `react-pdf` - PDF document display
- `date-fns-tz` - Timezone support

### Technical Constraints
- **Maintain shadcn/ui ecosystem** - Critical for design system [Source: TECHNICAL-DECISIONS.md#9]
- **Keep Supabase integration** - Core backend dependency [Source: architecture/3-high-level-architecture.md]
- **Preserve React Query** - Data fetching patterns established [Source: architecture/4-frontend-architecture-auth-roles-chat-uploads.md]
- **Ensure Vite compatibility** - Build system must remain fast [Source: architecture/1-goals-scope-constraints.md]

### Testing
**Package Installation Testing:**
- Clean npm install from scratch
- Verify no dependency conflicts or peer dependency warnings
- Test application startup and core functionality

**Security Testing:**
- Run `npm audit` and resolve all high/critical vulnerabilities
- Verify all dependencies are from trusted sources
- Check for known security issues in financial libraries

**Compatibility Testing:**
- Verify React 18 compatibility for all new packages
- Test TypeScript support for added libraries
- Ensure Vite build optimization works with new dependencies

Test file location: `src/test/` directory
Testing frameworks: Vitest for dependency compatibility tests
Specific testing requirements: Clean installation, security audit, application startup

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-09 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be added here*