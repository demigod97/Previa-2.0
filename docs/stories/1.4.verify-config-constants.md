# Story 1.4: Verify Config Constants

## Status
Draft

## Story
**As a** developer,
**I want** to verify and enhance the application configuration constants,
**so that** Previa has consistent business rules and thresholds for financial processing.

## Acceptance Criteria
1. Configuration constants file exists and is well-documented
2. All OCR and reconciliation thresholds are properly defined
3. Tier limits match database schema and business requirements
4. File processing configuration supports required formats and sizes
5. Error messages are user-friendly and actionable
6. Type safety is enforced for all configuration values
7. Constants are properly imported and used throughout the application

## Tasks / Subtasks
- [ ] Verify existing constants structure (AC: 1)
  - [ ] Review src/config/constants.ts for completeness
  - [ ] Ensure all constants have proper documentation and source references
  - [ ] Verify TypeScript types are exported for type safety
  - [ ] Check for any missing configuration categories
- [ ] Validate OCR and reconciliation thresholds (AC: 2)
  - [ ] Confirm OCR_ACCOUNT_NUMBER_THRESHOLD = 0.90 aligns with technical decisions
  - [ ] Verify OCR_RECEIPT_DATA_THRESHOLD = 0.90 for financial accuracy
  - [ ] Check RECONCILIATION_AUTO_APPROVE_THRESHOLD = 0.95 prevents false positives
  - [ ] Ensure RECONCILIATION_SUGGEST_THRESHOLD = 0.70 provides good UX balance
- [ ] Validate tier limits and freemium model (AC: 3)
  - [ ] Confirm FREE tier limits: 3 accounts, 50 trans/month, 10 receipts/month
  - [ ] Verify PREMIUM tier has unlimited access (999999 values)
  - [ ] Cross-reference with database schema in migration files
  - [ ] Check tier limit error messages reference correct values
- [ ] Verify file processing configuration (AC: 4)
  - [ ] Confirm MAX_FILE_SIZE = 50MB for bank statements and receipts
  - [ ] Validate SUPPORTED_STATEMENT_FORMATS includes PDF and CSV
  - [ ] Check SUPPORTED_RECEIPT_FORMATS includes PDF, JPG, JPEG, PNG
  - [ ] Verify PROCESSING_TIMEOUT = 30 seconds is reasonable for UX
- [ ] Review reconciliation matching rules (AC: 2)
  - [ ] Validate MAX_DATE_DIFFERENCE_DAYS = 3 for transaction matching
  - [ ] Check MAX_AMOUNT_DIFFERENCE = $0.50 for reasonable tolerance
  - [ ] Verify RECONCILIATION_WEIGHTS sum to 1.0 (40% + 40% + 20%)
  - [ ] Ensure weights align with AI matching algorithm requirements
- [ ] Validate UI and gamification configuration (AC: 5)
  - [ ] Check pagination constants (TRANSACTIONS_PER_PAGE, etc.) for good UX
  - [ ] Verify DEFAULT_DATE_RANGE_DAYS = 30 for dashboard queries
  - [ ] Review GAMIFICATION_POINTS for balanced reward system
  - [ ] Ensure points values encourage desired user behaviors
- [ ] Review error messages for user experience (AC: 5)
  - [ ] Check all error messages are user-friendly and actionable
  - [ ] Verify file size errors reference actual MAX_FILE_SIZE value
  - [ ] Ensure tier limit errors guide users toward premium upgrade
  - [ ] Confirm processing errors provide clear next steps
- [ ] Verify integration with application code (AC: 7)
  - [ ] Search codebase for usage of constants from this file
  - [ ] Add imports where constants should be used but aren't
  - [ ] Replace any hardcoded values with references to constants
  - [ ] Ensure type exports are used for type safety

## Dev Notes

### Previous Story Insights
Story 1.1 cleaned UI, Story 1.2 updated dependencies, Story 1.3 deployed database schema. This story ensures configuration constants align with the established database schema and technical decisions.

### Architecture Context
- **Business Rules:** Constants define core financial processing behavior [Source: TECHNICAL-DECISIONS.md#2, #3]
- **Type Safety:** TypeScript types enforce configuration consistency [Source: architecture/1-goals-scope-constraints.md]
- **Freemium Model:** Tier limits drive business model implementation [Source: TECHNICAL-DECISIONS.md#3]

### Configuration Analysis
**Constants File Status:** [Source: src/config/constants.ts analysis]
- ✅ **Comprehensive coverage:** OCR, reconciliation, tiers, processing, UI, gamification
- ✅ **Well-documented:** Each constant has purpose and decision reference
- ✅ **Type-safe:** Proper TypeScript types and const assertions
- ✅ **Business-aligned:** Values match technical decisions document

**OCR Thresholds Verification:** [Source: TECHNICAL-DECISIONS.md#2]
- `OCR_ACCOUNT_NUMBER_THRESHOLD = 0.90` ✅ Matches decision document
- `OCR_RECEIPT_DATA_THRESHOLD = 0.90` ✅ Ensures financial accuracy
- Below 90%: Flag for manual review (correct behavior)
- Between 90-95%: Extract but require confirmation (good UX)

**Reconciliation Thresholds:** [Source: TECHNICAL-DECISIONS.md#2]
- `RECONCILIATION_AUTO_APPROVE_THRESHOLD = 0.95` ✅ Prevents false positives
- `RECONCILIATION_SUGGEST_THRESHOLD = 0.70` ✅ Good balance for suggestions
- Weight distribution: 40% date + 40% amount + 20% merchant = 100% ✅

**Tier Limits Verification:** [Source: TECHNICAL-DECISIONS.md#3 + migration schema]
- FREE: 3 accounts, 50 trans/month, 10 receipts/month ✅ Matches database schema
- PREMIUM: Unlimited (999999) ✅ Effectively unlimited while avoiding null issues
- Error messages reference correct tier limits ✅

### File Processing Configuration
**File Support:** [Source: frontend-spec-new.md#2.3, #2.7]
- Statements: PDF, CSV ✅ Covers major bank export formats
- Receipts: PDF, JPG, JPEG, PNG ✅ Covers camera captures and digital receipts
- Max size: 50MB ✅ Reasonable for high-resolution scans

**Processing Timeouts:**
- 30 seconds before showing "processing" status ✅ Good UX balance
- Prevents user confusion while allowing for complex OCR operations

### UI Configuration Analysis
**Pagination Values:** [Source: frontend-spec-new.md]
- Transactions: 25 per page ✅ Good balance for table performance
- Receipts: 20 per page ✅ Suitable for card/grid layouts
- Matches: 15 per page ✅ Appropriate for detailed matching interface

**Dashboard Configuration:**
- Default 30-day range ✅ Covers monthly spending patterns
- Gamification points ✅ Balanced to encourage engagement without spam

### Integration Points
**Constants Usage Requirements:**
- Replace hardcoded file size limits with MAX_FILE_SIZE
- Use TIER_LIMITS in freemium upgrade prompts
- Apply OCR thresholds in document processing workflows
- Use reconciliation weights in AI matching algorithm

### Technical Constraints
- **Type Safety:** All constants must have proper TypeScript types [Source: architecture/1-goals-scope-constraints.md]
- **Documentation:** Each constant needs purpose and decision reference [Source: TECHNICAL-DECISIONS.md]
- **Consistency:** Values must align with database schema and business rules [Source: migration files]
- **Maintainability:** Constants should be the single source of truth for business rules

### Enhancement Opportunities
**Potential Additions:**
- Currency formatting constants for AUD display
- Date format constants for Australian date conventions
- Timezone configuration for Australia/Sydney
- Export format constants (CSV headers, etc.)

### Testing
**Configuration Testing:**
- Verify all constants are properly imported where needed
- Test type safety with TypeScript compilation
- Validate constants align with database schema values
- Check error messages render correctly in UI

**Integration Testing:**
- Test tier limit enforcement using these constants
- Verify OCR threshold behavior in document processing
- Test file upload validation with size and format limits

Test file location: `src/test/config/` directory
Testing frameworks: Unit tests with Vitest for constant validation
Specific testing requirements: Type safety, value consistency, proper imports

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-09 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be added here*